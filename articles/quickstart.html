<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClusterMQ Quick Start • clustermq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ClusterMQ Quick Start">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">clustermq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/userguide.html">User Guide</a>
</li>
<li>
  <a href="../articles/technicaldocs.html">Technical Documentation</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mschubert/clustermq">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="quickstart_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>ClusterMQ Quick Start</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mschubert/clustermq/blob/master/vignettes/quickstart.Rmd"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="hidden name"><code>quickstart.Rmd</code></div>

    </div>

    
    
<style type="text/css">
img {
    border: 0px !important;
    margin: 2em 2em 2em 2em !important;
}
code {
    border: 0px !important;
}
</style>
<p>This package will allow you to send function calls as jobs on a computing cluster with a minimal interface provided by the <code>Q</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># load the library and create a simple function</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(clustermq)</span>
<span id="cb1-3"><a href="#cb1-3"></a>fx =<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># queue the function call on your scheduler</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="../reference/Q.html">Q</a></span>(fx, <span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">n_jobs=</span><span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; Submitting 1 worker jobs (ID: 6859) ...</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>Computations are done <a href="https://github.com/armstrtw/rzmq">entirely on the network</a> and without any temporary files on network-mounted storage, so there is no strain on the file system apart from starting up R once per job. This way, we can also send data and results around a lot quicker.</p>
<p>All calculations are load-balanced, i.e. workers that get their jobs done faster will also receive more function calls to work on. This is especially useful if not all calls return after the same time, or one worker has a high load.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>First, we need the <a href="https://github.com/ropensci/rzmq#installation">ZeroMQ</a> system library. Most likely, your package manager will provide this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># You can skip this step on Windows and macOS, the rzmq binary has it</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># On a computing cluster, we recommend to use Conda or Linuxbrew</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="ex">brew</span> install zeromq <span class="co"># Linuxbrew, Homebrew on macOS</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="ex">conda</span> install zeromq <span class="co"># Conda</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">sudo</span> apt-get install libzmq3-dev <span class="co"># Ubuntu</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">sudo</span> yum install zeromq3-devel <span class="co"># Fedora</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="ex">pacman</span> -S zeromq <span class="co"># Arch Linux</span></span></code></pre></div>
<p>Then install the <code>clustermq</code> package in R (which automatically installs the <code>rzmq</code> package as well) from CRAN:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'clustermq'</span>)</span></code></pre></div>
<p>Alternatively you can use <code>devtools</code> to install directly from Github:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># install.packages('devtools')</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">'mschubert/clustermq'</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># devtools::install_github('mschubert/clustermq', ref="develop") # dev version</span></span></code></pre></div>
<p>You should be good to go!</p>
<p>By default, <code>clustermq</code> will look for <code>sbatch</code> (SLURM), <code>bsub</code> (LSF), or <code>qsub</code> (SGE) in your <code>$PATH</code> and use the scheduler that is available. If the examples don’t run out of the box, you might need to set your scheduler explicitly.</p>
</div>
<div id="setting-up-the-scheduler-explicitly" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-the-scheduler-explicitly" class="anchor"></a>Setting up the scheduler explicitly</h2>
<p>An HPC cluster’s scheduler ensures that computing jobs are distributed to available worker nodes. Hence, this is what clustermq interfaces with in order to do computations.</p>
<p>We currently support the <a href="https://mschubert.github.io/clustermq/articles/userguide.html#setting-up-the-scheduler">following schedulers</a>:</p>
<ul>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#lsf">LSF</a> - <em>should work without setup</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#sge">SGE</a> - <em>should work without setup</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#slurm">SLURM</a> - <em>should work without setup</em>
</li>
<li>
<a href="https://mschubert.github.io/clustermq/articles/userguide.html#pbs">PBS</a>/<a href="https://mschubert.github.io/clustermq/articles/userguide.html#torque">Torque</a> - <em>needs</em> <code><a href="https://rdrr.io/r/base/options.html">options(clustermq.scheduler="PBS"/"Torque")</a></code>
</li>
</ul>
<p>You can also access each of these schedulers from your local machine via the <a href="https://mschubert.github.io/clustermq/articles/userguide.html#ssh-connector">SSH connector</a>. Results will be returned to your local session.</p>
<p>If you need specific <a href="https://mschubert.github.io/clustermq/articles/userguide.html#environments">computing environments or containers</a>, you can activate them via the scheduler template.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>The package is designed to distribute arbitrary function calls on HPC worker nodes. There are, however, a couple of caveats to observe as the R session running on a worker does not share your local memory.</p>
<p>The simplest example is to a function call that is completely self-sufficient, and there is one argument (<code>x</code>) that we iterate through:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>fx =<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw"><a href="../reference/Q.html">Q</a></span>(fx, <span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">n_jobs=</span><span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; Submitting 1 worker jobs (ID: 7393) ...</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>Non-iterated arguments are supported by the <code>const</code> argument:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fx =<span class="st"> </span><span class="cf">function</span>(x, y) x <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw"><a href="../reference/Q.html">Q</a></span>(fx, <span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">const=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">y=</span><span class="dv">10</span>), <span class="dt">n_jobs=</span><span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; Submitting 1 worker jobs (ID: 7393) ...</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; [1] 12</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; [1] 14</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; [1] 16</span></span></code></pre></div>
<p>If a function relies on objects in its environment that are not passed as arguments, they can be exported using the <code>export</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>fx =<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="../reference/Q.html">Q</a></span>(fx, <span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">export=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">y=</span><span class="dv">10</span>), <span class="dt">n_jobs=</span><span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; Submitting 1 worker jobs (ID: 7393) ...</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; [1] 12</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; [1] 14</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; [1] 16</span></span></code></pre></div>
<p>If we want to use a package function we need to load it on the worker using a <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> call or referencing it with <code>package_name::</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>fx =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="st">`</span><span class="dt">%&gt;%</span><span class="st">`</span> =<span class="st"> </span>dplyr<span class="op">::</span><span class="st">`</span><span class="dt">%&gt;%</span><span class="st">`</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    x <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">area =</span> Sepal.Length <span class="op">*</span><span class="st"> </span>Sepal.Width) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">        </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</span>
<span id="cb8-6"><a href="#cb8-6"></a>}</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw"><a href="../reference/Q.html">Q</a></span>(fx, <span class="dt">x=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(iris), <span class="dt">n_jobs=</span><span class="dv">1</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; Submitting 1 worker jobs (ID: 7393) ...</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species  area</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa 17.85</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa 14.70</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa 15.04</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa 14.26</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa 18.00</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa 21.06</span></span></code></pre></div>
<p><code>clustermq</code> can also be used as a parallel backend for <a href="https://cran.r-project.org/package=foreach"><code>foreach</code></a>. As this is also used by <a href="http://bioconductor.org/packages/release/bioc/html/BiocParallel.html"><code>BiocParallel</code></a>, we can run those packages on the cluster as well:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(foreach)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw"><a href="../reference/register_dopar_cmq.html">register_dopar_cmq</a></span>(<span class="dt">n_jobs=</span><span class="dv">2</span>, <span class="dt">memory=</span><span class="dv">1024</span>) <span class="co"># accepts same arguments as `workers`</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span>(<span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%dopar%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(i) <span class="co"># this will be executed as jobs</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; Submitting 2 worker jobs (ID: 7326) ...</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; </span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; [1] 1.414214</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; [1] 1.732051</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(BiocParallel)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">register</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/BiocParallel/man/DoparParam-class.html">DoparParam</a></span>()) <span class="co"># after register_dopar_cmq(...)</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw"><a href="https://rdrr.io/pkg/BiocParallel/man/bplapply.html">bplapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, sqrt)</span></code></pre></div>
<p>More examples are available in <a href="https://mschubert.github.io/clustermq/articles/userguide.html">the user guide</a>.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The following arguments are supported by <code>Q</code>:</p>
<ul>
<li>
<code>fun</code> - The function to call. This needs to be self-sufficient (because it will not have access to the <code>master</code> environment)</li>
<li>
<code>...</code> - All iterated arguments passed to the function. If there is more than one, all of them need to be named</li>
<li>
<code>const</code> - A named list of non-iterated arguments passed to <code>fun</code>
</li>
<li>
<code>export</code> - A named list of objects to export to the worker environment</li>
</ul>
<p>Behavior can further be fine-tuned using the options below:</p>
<ul>
<li>
<code>fail_on_error</code> - Whether to stop if one of the calls returns an error</li>
<li>
<code>seed</code> - A common seed that is combined with job number for reproducible results</li>
<li>
<code>memory</code> - Amount of memory to request for the job (<code>bsub -M</code>)</li>
<li>
<code>n_jobs</code> - Number of jobs to submit for all the function calls</li>
<li>
<code>job_size</code> - Number of function calls per job. If used in combination with <code>n_jobs</code> the latter will be overall limit</li>
<li>
<code>chunk_size</code> - How many calls a worker should process before reporting back to the master. Default: every worker will report back 100 times total</li>
</ul>
<p>The full documentation is available by typing <code><a href="../reference/Q.html">?Q</a></code>.</p>
</div>
<div id="comparison-to-other-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-to-other-packages" class="anchor"></a>Comparison to other packages</h2>
<p>There are some packages that provide high-level parallelization of R function calls on a computing cluster. A thorough comparison of features and performance is available <a href="https://github.com/mschubert/clustermq/wiki#comparison-to-other-packages">on the wiki</a>.</p>
<p>Briefly, we compare how long it takes different HPC scheduler tools to submit, run and collect function calls of negligible processing time (multiplying a numeric value by 2). This serves to quantify the maximum throughput we can reach with <code>BatchJobs</code>, <code>batchtools</code> and <code>clustermq</code>.</p>
<p>We find that <code>BatchJobs</code> is unable to process 10<sup>6</sup> calls or more but produces a reproducible <code>RSQLite</code> error. <code>batchtools</code> is able to process more function calls, but the file system practically limits it at about 10<sup>6</sup> calls. <code>clustermq</code> has no problems processing 10<sup>9</sup> calls, and is still faster than <code>batchtools</code> at 10<sup>6</sup> calls.</p>
<p><img src="http://image.ibb.co/cRgYNR/plot.png"></p>
<p>In short, use <code>ClusterMQ</code> if you want:</p>
<ul>
<li>a one-line solution to run cluster jobs with minimal setup</li>
<li>access cluster functions from your local Rstudio via SSH</li>
<li>fast processing of many function calls without network storage I/O</li>
</ul>
<p>Use <a href="https://github.com/mllg/batchtools"><code>batchtools</code></a> if:</p>
<ul>
<li>want to use a mature and well-tested package</li>
<li>don’t mind that arguments to every call are written to/read from disc</li>
<li>don’t mind there’s no load-balancing at run-time</li>
</ul>
<p>Use <a href="https://snakemake.readthedocs.io/en/latest/">Snakemake</a> (or <a href="https://github.com/sahilseth/flowr"><code>flowr</code></a>, <a href="https://github.com/richfitz/remake"><code>remake</code></a>, <a href="https://github.com/ropensci/drake"><code>drake</code></a>) if:</p>
<ul>
<li>you want to design and run a pipeline of different tools</li>
</ul>
<p>Don’t use <a href="https://cran.r-project.org/package=batch"><code>batch</code></a> (last updated 2013) or <a href="https://github.com/tudo-r/BatchJobs"><code>BatchJobs</code></a> (issues with SQLite on network-mounted storage).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#setting-up-the-scheduler-explicitly">Setting up the scheduler explicitly</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#usage">Usage</a></li>
      <li><a href="#comparison-to-other-packages">Comparison to other packages</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Schubert.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
